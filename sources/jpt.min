#!/usr/bin/env bash
#!/usr/bin/env zsh
#choose your shell with the first line, works in both

#############
# FUNCTIONS #
#############

#BEGIN FUNCTION
function jpt()( #v1.0.6 jpt([options] [query] [fileArg])
{ set +x; } &> /dev/null
: <<-LICENSE_BLOCK
jpt - JSON Power Tool (for more info: https://github.com/brunerd/jpt)
Copyright (c) 2020 Joel Bruner
Other portions: Copyright (c) 2007 Stefan Goessner (goessner.net), Copyright (c) 2020 "jpaquit" (https://github.com/jpaquit), Copyright (c) 2016 Kris Nye, Copyright (c) 2012 Dharmafly
Licensed under the MIT License
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
LICENSE_BLOCK

#help text - remove to save 14k
read -r -d '' helpText <<'EOT'
jpt (v1.0.6) - JSON Power Tool (https://github.com/brunerd/jpt)\n\nUsage:\njpt [options] [<query>] [<file>]\n\nArguments:\n\t[<query>] - JSONPath, JSON Pointer, or plutil-style keypath expression (optional), returns entire document otherwise.\n\t[<file>] - path to JSON file\n\nNotes:\n\tDefault output mode is JSON (RFC8259/STD90)\n\tMultiple JSON texts will be output as a JSON Text Sequence (RFC 7464) (use -M to change behavior and processing)\n\tjpt accepts input by file redirection, Unix pipe, here string, heredoc and via /dev/stdin (end with Control-D)\n\tjpt accepts JSON, JSON text Sequences, and non-JSON mutations such as JSON5, NDJSON and jpt's own JSONPath Object Literals\n\tJSON Text Sequences will be strictly parsed to RFC 7464 specs, non-JSON elements are only tolerated in single and concatenated JSON texts\n\tNon-JSON elements are corrected automatically, if possible, before parsing (use -c for comments via stderr with an exit status of 1)\n\t  JSON5 Rehabilitations (mostly):\n\t    Unquoted object keys and single quoted strings are converted to JSON strings\n\t    Additional Unicode whitespaces and paragraph separators are converted to normal spaces (0x20) and newlines (0x0A)\n\t    Trailing commas are removed from object and array elements\n\t    Explicit plus signs on numbers are removed, decimals without leading zeroes are restored\n\t    Multi-line strings with escaped line breaks are reverted to standard JSON strings\n\t      Literal tabs in strings are removed also\n\t    Escaped character conversions: \n\t\t  \\0 to null\n\t\t  \\v to '\\u000c'\n\t    JSON5 number type conversions: \n\t\t  NaN to null (use -8 to convert to "NaN" string)\n\t\t  Inifinity to null (use -I to convert to "Infinity" string, with sign if specified)\n\t    Single-line (//) and multi-line (/* */) style comments are removed\n\t\t  Additionally multi-line XML (<!-- -->) and single line Shell (#), ASM (;), and Lua (--) comments are removed\n\t\nGeneral Options:\n\t-h this help screen\n\nJSON Output Options:\n\t-i "<number/string>" indent number of spaces (0-10) or use a <string> for each level of indent\n\t-O Order property names in objects alphabetically\n\t-u Unicode escape (\\u) all characters above 0x7E\n\nAdvanced JSON Output Options:\n\t-a always output result in an array\n\t-c comment on corrections to non-standard JSON via stderr output (with exit status of 1)\n\t-F Flatten array output\n\t-I Convert JSON5 +/-Infinity value to a string with signedness (otherwise converts to null)\n\t-N Nested single element arrays are reduced\n\t-8 Convert JSON5 NaN to a string (otherwise converts to null)\n\t-/ Escape solidus / with a reverse solidus like \\/, useful for HTML with embedded JSON encoded HTML\n\nInput Options:\n\t-D Detect truncation within objects and arrays in concatenated JSON only\n\t-g path-only JSONPath Object Literals are assigned a value of null ("gratis nulls")\n\t-G Guard previously defined JSONPath Object Literals from being modified by new statements\n\t-H Help truncated JSON by closing up open strings, objects and arrays\n\t-S Treat input as a JSON string\n\nMultiple JSON Text Options:\n\t-M "<value>" - options for working with multiple JSON texts\n\t\tS - Output JSON Text Sequences strictly conforming to RFC 7464 (default)\n\t\tN - Output newline delimited JSON texts\n\t\tC - Output concatenated JSON texts\n\t\tA - Gather JSON texts into an array, post-query and post-patching\n\t\ta - Gather JSON texts into an array, pre-query and pre-patching \n\nAlternate Output Modes (non-JSON):\n\t-l output the length of the resulting array, object property count, or length of string\n\n\t-J JSONPath path(s) of the object returned by the query\n\t-j JSONPath path(s) matched by the query results\n\n\t-R JSON Pointer path(s) of the object returned by the query\n\t-r JSON Pointer path(s) matched by the query results\n\t\tSpecifiying -EW or -Ew encodes both -r and -R JSON Pointer paths in URI fragment style\n\n\t  -J and -R path output options:\n\t\t-C append the "constructor" type (Array, Object, String, Boolean, Number, or null)\n\t\t-K/-k print property (key) names and array indices only with no preceding path, default indent is 2\n\t\t\t-i "<value>" indent spaces (0-10) or character for each level of indent\n\n\t-L JSONPath Object Literal notation output of the resulting object\n\t\tJPOL Format: <JSONPath expression>=<JSON value>\n\t\t\t<JSONPath expression> is simply Javascript expression syntax with $ as the object name\n\t\t\t\tExample: $.key, $["key"], $['key'], or $[0]\n\t\t\t<JSON value> is any valid JSON value (plus single quoted strings)\n\t\t\t\tExample: 'string', "string", [], {}, 42, true, false, null\n\n\t  JSONPath output options for -L -J and -j:\n\t\t-d Use dot notation for object property names when possible, rather than bracket notation\n\t\t-q Use single quotes for bracketed property names, string values remain JSON double quoted\n\t\t-Q Use single quotes for BOTH bracketed property names AND string values (-L only)\n\t\t-u encode characters above 7E with \\u escape\n\n\t  Output limiting options for -L, -J, and -R:\n\t\t-P Only print Primitive data types (String, Boolean, Number, null) omitting Arrays and Objects\n\t\t-Z "<int>" Depth\n\t\t\tCombined with -L it will coalesce lower depth levels into a compound JSON object/array statement\n\t\t\tCombined with -P both -J and -R will return only purely primitive nodes at or below the Z level\n\n\t-T textual output of all data (omits property names and indices)\n\t  Options:\n\t\t-e encode whitespace and escapes: \\b \\f \\n \\r \\t \\v and \\\\ (\\ escaped formats only)\n\t\t-i "<value>" indent spaces (0-10) or character string for each level of indent\n\t\t-n convert null value to string 'null' (pre-encoding)\n\n\t\t-E "<value>" encoding options for -T output:\n\n\t\t  Encodes string characters below 0x20 and above 0x7E with pass-through for all else:\n\t\t\tx \t"\\x" prefixed hexadecimal UTF-8 strings\n\t\t\tO \t"\\nnn" style octal for UTF-8 strings\n\t\t\t0 \t"\\0nnn" style octal for UTF-8 strings\n\t\t\tu \t"\\u" prefixed Unicode for UTF-16 strings\n\t\t\tU \t"\\U "prefixed Unicode Code Point strings\n\t\t\tE \t"\\u{...}" prefixed ES2016 Unicode Code Point strings\n\t\t\tW \t"%nn" Web encoded UTF-8 string using encodeURI (respects scheme and domain of URL)\n\t\t\tw \t"%nn" Web encoded UTF-8 string using encodeURIComponent (encodes all components URL)\n\n\t\t\t  -W encodes whitespace characters also\n\t\t\t  -A encodes ALL characters\n\t\t\n\t\t  Encodes both strings and numbers with pass-through for all else:\n\t\t\th \t"0x" prefixed lowercase hexadecimal, UTF-8 strings\n\t\t\tH \t"0x" prefixed uppercase hexadecimal, UTF-8 strings\n\t\t\to \t"0o" prefixed octal, UTF-8 strings\n\t\t\t6 \t"0b" prefixed binary, 16 bit _ spaced numbers and UTF-16 strings\n\t\t\tB \t"0b" prefixed binary, 8 bit _ spaced numbers and UTF-16 strings\n\t\t\tb \t"0b" prefixed binary, 8 bit _ spaced numbers and UTF-8 strings\n\n\t\t\t  -U whitespace is left untouched (not encoded)\n\nData Processing:\n\tjpt can apply JSON Patch (RFC 6902), JSON Merge Patch (RFC 7396), and other operations to JSON text(s)\n\n\tJSON Patch processing:\n\t\t-X "<filepath to JSON Patch>" a file path to a JSON Patch array (RFC 6902)\n\t\t-x "<inline JSON Patch>" inline JSON Patch text (RFC 6902)\n\t\t\n\tJSON Patch Example (from RFC 6902):\n\t\t [\n\t\t\t { "op": "test", "path": "/a/b/c", "value": "foo" },\n\t\t\t { "op": "remove", "path": "/a/b/c" },\n\t\t\t { "op": "add", "path": "/a/b/c", "value": [ "foo", "bar" ] },\n\t\t\t { "op": "replace", "path": "/a/b/c", "value": 42 },\n\t\t\t { "op": "move", "from": "/a/b/c", "path": "/a/b/d" },\n\t\t\t { "op": "copy", "from": "/a/b/d", "path": "/a/b/e" }\n\t\t]\n\n\tSingle operations for JSON Patch, JSON Merge Patch, and others can be crafted using -o plus -p (path) and possibly -f (from) or -v/-V (value)\n\n\t\t-o "<operation>":\n\t\t [JSON Patch Operations]\n\t\t  add\n\t\t\t-o add -p "<path>" -v "<value>"\n\t\t\t\tadd/replace value in object or insert value into array index (RFC 6902)\n\t\t  replace\n\t\t\t-o replace -p "<path>" -v "<value>"\n\t\t\t\treplace value of existing object property (key) or array index (RFC 6902)\n\t\t  remove\n\t\t\t-o remove -p "<path>"\n\t\t\t\tremove specified path from the document (RFC 6902)\n\t\t  move\n\t\t\t-o move -f "<from>" -p "<path>"\n\t\t\t\tmove a path to a new or existing path/node(RFC 6902)\n\t\t  copy\n\t\t\t-o copy -f "<from>" -p "<path>"\n\t\t\t\tcopy a path to a new or existing path/node (RFC 6902)\n\t\t  test\n\t\t\t-o test -p "<path>" -v "<value>"\n\t\t\t\ttest if a path matches a value exactly (RFC 6902), return 0 if true, 1 if false\n\n\t\t [Other Operations]\n\t\t  diff\n\t\t\t-o diff -v "<value>"\n\t\t\t\tGiven a value, compare with JSON text and produce a JSON Merge Patch (RFC 7396) document\n\t\t  mergepatch\n\t\t\t-o mergepatch (-v/-V "<value>" || -f "<path>") [-p <path>]\n\t\t\t\tJSON Merge Patch (RFC 7396) operation: null values delete target object property\n\t\t\t\tCan pull data from -v/-V "<value>" OR -f "<path>", can merge to specific -p "<path>" (JSONPaths allows multiple)\n\t\t  merge\n\t\t\t-o merge (-v/-V "<value>" || -f "<path>") [-p "<path>"]\n\t\t\t\tNon-RFC 7396 merging operation, object properties with null values are NOT removed\n\t\t\t\tCan pull data from -v/-V "<value>" or -f "<path>", can merge to specific -p "<path>" (JSONPaths allows multiple)\n\t\t  merge0\n\t\t\t-o merge0 (-v/-V "<value>" || -f "<path>") [-p "<path>"]\n\t\t\t\tMerge object properties that DO NOT intersect with source JSON\n\t\t\t\tCan pull data from -v/-V "<value>" or -f "<path>", can merge to specific -p "<path>" (JSONPaths allows multiple)\n\t\t  merge1\n\t\t\t-o merge1 (-v/-V "<value>" || -f "<path>") [-p "<path>"]\n\t\t\t\tMerge object properties that intersect with source JSON\n\t\t\t\tCan pull data from -v/-V "<value>" or -f "<path>", can merge to specific -p "<path>" (JSONPaths allows multiple)\n\t\t\t\t\n\t\t-p "<path>":\n\t\t\t-p "<path>" the target path expressed in JSON Pointer (RFC 6901) or JSONPath\n\n\t\t-f "<from path>":\n\t\t\tcopy and move require a JSON Pointer (RFC 6901) or JSONPath expression\n\n\t\t-v/-V "<value>":\n\t\t\t-v "<JSON value>" is a single JSON text\n\t\t\t-V "<filespec to JSON value>" is a file path to a single JSON text\n\t\t  Options for -v/-V:\n\t\t\t-s treat input as a string\n\t\t\t\t\nJSONPath Primer\n\t$\n\t\tthe root of the JSON document, ALL JSONPath QUERIES MUST BEGIN WITH $\n\t.key or ['key']\n\t\ta "child" operator for an object property named 'key' in a JSON object\n\t..key or ..['key']\n\t\tis a recursive operator that will find all properties named 'key' within the object\n\t['key name'] or ["key \ud83d\udd11"]\n\t\tproperty names with spaces or escaped values MUST use bracket notation\n\t.* or [*]\n\t\t* returns the values of all the keys within an object or all indices in an array\n\t[start:stop:step]\n\t\tslice operation for arrays, accepts pos/neg integers, script and filter expressions, or leave empty\n\t[?(@.id >= 1 && @.id <= 10 )] or [?(@.key == "string" && !@['key2'])] or the off-spec [?(@name =~ /key.*/)], etc...\n\t\tfilter expressions can return one or more matching objects within an array\n\t\t@ is the current object, dot and bracket notation can be used to query child nodes\n\t\tUse logical operators like: == (equal), != (not equal), > (greater than), < (less than), >= (greater or equal), <= (less or equal)\n\t\tMultiple criteria can be evaluated with && (AND) and || (OR). Regular expressions can also be used: '=~ /regexp/'\n\t\tYou can negate a value using !\n\t\t@.length is the length of an array or string\n\t\t@name is the current property name (an off-spec but useful quirk of the original Goessner code)\n\t[(@.length/2)]\n\t\t"script expression", returns a single value, use as an array index selector that allow division\n\t\tNote: These will NOT make it into the IETF JSONPath spec\n\t[1] or [-1]\n\t\tarray index, integers only, positive starts at the beginning, negative references from the end \n\t["-"]\n\t\tThe nonexistent array member after the last array element\n\t\tUse with data alteration operations, will always be empty for queries of arrays\n\t\tAkin to /- in JSON Pointer, if used with an object simply looks for a key named "-"\n\t["a","b"]\n\t\tunion, a comma separated list of expressions values of multiple properties at the same level in an object\n\t\tUnions allow for: quoted property names (single or double), numbers, *, filter and script expressions, and slices\n\n\tFor more examples: https://github.com/brunerd/jsonpath\n\t\nJSON Pointer (RFC 6901) Primer\n\t""\t\tan empty string represents the JSON document\n\t/\t\tis the root or next child node with a property named "" an empty string (JSONPath $[""])\n\t/key\t\tproperty named key in an object\n\t/1\t\tproperty named 1 in an object or a numeric index in an array\n\t/-\t\tthe nonexistent array member after the last array element, use with data alteration operations\n\t~\t\tin a property name must be escaped as ~0\n\t/\t\tin a property name must be escaped as ~1\n\n\tExample: /JSON pointer/does/this/1/thing/well\n\nkeypath primer:\n\tThis arcane summoning hails from ye olde NextStep and still used by plutil\n\t\n\t.\t\ta period is used to delimit key names, \n\t\t\t\tliteral periods can be backslash (\\) escaped\n\tkey\t\tan object name or array element, there is no root character\n\t\t\t\t\t\t\t\t\n\tKeypath Example: this.is.1.ugly.key\\.path\n\n\tIn JSON Pointer: /this/is/1/ugly/key.path\n\tAnd in JSONPath: $.this.is[1].ugly.["key.path"]\n\n\tNote: If a keypath query begins with characters that collide with JSONPath ($), jq-style (. or [) or JSON Pointer (/) it will be evaluated as one of those.
EOT

#JavaScript
read -r -d '' JSCode <<-'EOT'
function jsonPath(b,k,e){var d={resultType:e&&e.resultType||"VALUE",singleQuoteKeys:e&&e.singleQuoteKeys||!1,escapeUnicode:e&&e.escapeUnicode||!1,result:[],normalize:function(g){if(null===g.constructor||g.constructor!==String)return g},asPath:function(g){if("PATH_OBJECT"===d.resultType)return{path:g};var r=d.singleQuoteKeys?"'":'"',p="PATH_JSONPOINTER"===d.resultType?"":"$";g=g.slice();for(var m=0,c=g.length;m<c;m++)p="PATH_JSONPOINTER"===d.resultType?p+("/"+(g[m].constructor===Number?g[m]:g[m].replace(/~/g,"~0").replace(/\//g,"~1"))):p+(g[m].constructor===Number?"["+g[m]+"]":"PATH_DOTTED"===d.resultType&&/^[A-Za-z_$][\w\d$]*$/.test(g[m])?"."+g[m]:"["+r+g[m].replace(d.escapeUnicode?/[\u0000-\u001f\u007f-\uffff|\\|"|']/g:/[\u0000-\u001f\u007f|\\|"|']/g,function(n){switch(n){case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case "\\":return"\\\\";case '"':return d.singleQuoteKeys?'"':'\\"';case "'":return d.singleQuoteKeys?"\\'":"'";default:return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)}})+r+"]");return p},store:function(g,r){d.escapeUnicode&&null!==r&&r.constructor===String&&(r=r.replace(/[\u007F-\uFFFF]/g,function(p){return"\\u"+("0000"+p.charCodeAt(0).toString(16)).slice(-4)}));g&&(d.result[d.result.length]=/^PATH/.test(d.resultType)?d.asPath(g):r);return!!g},trace:function(g,r,p){if(!1===g)return g;if(g.length){g=g.slice();var m=g.shift();if(null!==r&&Array.isArray(r)&&m.constructor===String&&m.match(/^0/)&&"0"!==m)throw Error("Property name '"+m+"' is a string with leading zeros and target is an array!");m.constructor===Number&&-1===Math.sign(m)&&(r instanceof Array||r.constructor===String)&&(m=r.length+m);if(Array.isArray(m))for(var c=0;c<m.length;c++){var n=g.slice();n.unshift(m[c]);d.trace(n,r,p)}else m.constructor===Object?Array.isArray(m.expression)?d.slice(m.expression,g,r,p):"*"===m.expression?d.walk(m.expression,g,r,p,function(q,f,a,l,h){f=a.slice();f.unshift(q);d.trace(f,l,h)}):".."===m.expression?(d.trace(g,r,p),d.walk(m,g,r,p,function(q,f,a,l,h){f=a.slice();f.unshift({expression:".."});h=h.slice();h.push(q);"object"===typeof l[q]&&d.trace(f,l[q],h)})):/^\(.*?\)$/.test(m.expression)?(n=g.slice(),n.unshift(d.eval(m.expression,r,p[p.length-1])),d.trace(n,r,p)):/^-$/.test(m.expression)?null!==r&&Array.isArray(r)&&(n=g.slice(),n.unshift(d.eval("(@.length)",r,p[p.length-1])),d.trace(n,r,p)):/^\?\(.*?\)$/.test(m.expression)&&d.walk(m.expression,g,r,p,function(q,f,a,l,h){d.eval(f.replace(/^\?\((.*?)\)$/,"$1"),l instanceof Array?l[q]:l,q)&&(f=a.slice(),f.unshift(q),d.trace(f,l,h))}):r&&r.constructor!==String&&void 0!==r[m]&&(p=p.slice(),p.push(Array.isArray(r)?Number(m):m),d.trace(g,r[m],p))}else d.store(p,r)},walk:function(g,r,p,m,c){if(p instanceof Array)for(var n=0,q=p.length;n<q;n++)n in p&&c(n,g,r,p,m);else if("object"===typeof p)for(n in p)p.hasOwnProperty(n)&&c(n,g,r,p,m)},slice:function(g,r,p,m){if(p instanceof Array){var c=1;g[0]=void 0!==g[0]?g[0]:null;g[1]=void 0!==g[1]?g[1]:null;g[2]=void 0!==g[2]?g[2]:null;if(0===(null===g[2]||g[2].constructor===Number?g[2]:d.eval(g[2].expression,p,m[m.length-1])))throw new RangeError("Slice step cannot be zero: ["+g.join(":")+"]");c=parseInt((null===g[2]||g[2].constructor===Number?g[2]:d.eval(g[2].expression,p,m[m.length-1]))||c);if(-1===Math.sign(c)){var n=p.length;var q=n-1;var f=-1*(n+(null===g[1]?1:0))}else n=p.length,q=0,f=n;q=parseInt((null===g[0]||g[0].constructor===Number?g[0]:d.eval(g[0].expression,p,m[m.length-1]))||(0===(null===g[0]||g[0].constructor===Number?g[0]:d.eval(g[0].expression,p,m[m.length-1]))?0:q));f=0===g[1]?0:parseInt((null===g[1]||g[1].constructor===Number?g[1]:d.eval(g[1].expression,p,m[m.length-1]))||f);q=0>q?Math.max(-1===Math.sign(c)?-1:0,q+n):Math.min(n,q);f=0>f?Math.max(-1===Math.sign(c)?-1:0,f+n):Math.min(n,f);for(g=-1===Math.sign(c)?">":"<";eval(q+g+f);q+=c)n=r.slice(),n.unshift(q),d.trace(n,p,m)}},eval:function(g,_v,_vname){r=g.slice();/^\(.*?\)$/.test(g)&&(r=r.replace(/^\((.*?)\)$/,"$1"));r=r.split("").reverse().join("").replace(/(["'])(.*?)\1(?!\\)/g,"").replace(/(\/.*?\/(?!\\)\s*~=)|(=~*\s\/.*?\/(?!\\))/g,"").replace(/\(\s*/g,"(").replace(/([;\.\+\-~!\*\/%><&\^\|:\?,])/g," ").replace(/\s+/g," ").split("").reverse().join("").split(" ").filter(function(m){return/\(/.test(m)}).filter(function(m){return/[!^]\(|[\w\d_$]\(/.test(m)}).filter(function(m){return!/test\(|exec\(|match\(/.test(m)});if(r.length)throw Error("Invocation violation: "+r);try{return eval(g.replace(/(^|[^\\])@/g,"$1_v").replace(/\\@/g,"@").replace(/(_v(?:(?!(\|\||&&)).)*)=~((?:(?!\)* *(\|\||&&)).)*)/g,function(m,c,n,q,f,a){return m?q.trim()+".test("+c.trim()+")":m}).replace(/((?:(?!\)* *(\|\||&&)).)*)\s+=~\s+(_v(?:(?!(\|\||&&)).)*)/g,function(m,c,n,q,f,a){return m?c.trim()+".test("+q.trim()+")":m}))}catch(m){throw new SyntaxError("eval: "+m.message+": "+g.replace(/(^|[^\\])@/g,"$1_v").replace(/\\@/g,"@").replace(/(_v(?:(?!(\|\||&&)).)*)=~((?:(?!\)* *(\|\||&&)).)*)/g,function(c,n,q,f,a,l){return c?f.trim()+".test("+n.trim()+")":c}).replace(/((?:(?!\)* *(\|\||&&)).)*)\s+=~\s+(_v(?:(?!(\|\||&&)).)*)/g,function(c,n,q,f,a,l){return c?f.trim()+".test("+n.trim()+")":c}));}}};if(k&&void 0!==b&&("VALUE"==d.resultType||/^PATH/.test(d.resultType)))return d.trace(d.normalize(k),b,[]),d.result.length?d.result:[]}function jscChunkPrint(b){var k=0,e=b.length,d='\n "," ", ," },{ ":" ":{'.split(" ");do{if(k+maxSize.print>e)var g=e;else{for(var r=0;r<=d.length-1;r++){var p=b.lastIndexOf(d[r],k+maxSize.print);if(-1!==p&&p>k){g=p+d[r].length-1;break}}p<k&&(g=k+maxSize.print)}print(b.slice(k,g));if(g===e)break;k="\n"===b.charAt(g)?g+1:g}while(g<e)}function renderObject(b,k,e,d){e=e||{};e.maxDepth=void 0===e.maxDepth||-1>e.maxDepth?-1:e.maxDepth;var g=e.q?"'":'"',r=e.Q?"'":'"',p=[],m="",c=function(x,A){var B="";if(x.constructor===Number)for(var z=0;z<x;z++)B+=" ";else B=x;for(z=0;z<A;z++)m+=B;return m};isNaN(d)?d=0:d++;!e.K||e.J||e.R||(e.K=!1);(e.K||e.T)&&e.i&&(m=c(e.spaceArg,d));if(null===b){var n=!0;b=e.n||k?"null":""}c=b.constructor===Number?": Number":b.constructor!==String||n?b.constructor===Array?": Array":b.constructor===Object?": Object":b.constructor===Boolean?": Boolean":": null":": String";if(b.constructor===Array)!e.J&&!e.R||e.P||!k&&""!==k?e.P||!k&&""!==k||p.push(m+k+(e.K?e.C?c:"":d===e.maxDepth?"="+JSON.stringify(b,null,0):"=[]")):p.push(m+k+(e.C?": Array":"")),(-1===e.maxDepth||d<e.maxDepth)&&b.forEach(function(x,A){p.push(renderObject(x,k||""===k?e.K?A.toString():k+(e.R?"/"+A:"["+A+"]"):null,e,d))});else if(b.constructor===Object){if(!e.J&&!e.R||e.P||!k&&""!==k?!k&&""!==k||e.P||p.push(m+k+(e.K?e.C?c:"":d===e.maxDepth?"="+JSON.stringify(b,null,0):"={}")):p.push(m+k+(e.C?": Object":"")),-1===e.maxDepth||d<e.maxDepth)for(var q in b)if(b.hasOwnProperty(q)){if(k||""===k)if(e.R)var f=(e.K?"":k+"/")+q.replace(/~/g,"~0").replace(/\//g,"~1");else if(e.d&&!e.K&&/^[A-Za-z_$][$\w\d]*$/.test(q))f=(e.K?"":k+".")+q;else{var a=q.replace(e.u?/[\u0000-\u001f\u007f-\uffff|\\|"|']/g:/[\u0000-\u001f\u007f|\\|"|']/g,function(x){switch(x){case " ":return" ";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case "\\":return"\\\\";case '"':return"'"===g?'"':'\\"';case "'":return"'"===g?"\\'":"'";default:return"\\u"+("0000"+x.charCodeAt(0).toString(16)).slice(-4)}});f=e.K&&!e.L?e.k?a:g+a+g:k+"["+g+a+g+"]"}p.push(renderObject(b[q],f,e,d))}}else if(e.T){if("string"===typeof b&&!n)if(e.encoding.W&&!e.A)b=encodeURI(b);else if(e.encoding.w&&!e.A)b=encodeURIComponent(b);else{var l=[],h=q="";f=n="";if(e.encoding.x){a=-2;q="0";var t="\\x",u=16}else if(e.encoding["0"])t="\\0",u=8,a=-3,q="00";else if(e.encoding.O)q="00",t="\\",u=8,a=-3;else if(e.encoding.u){t="\\u";q="0000";a=-8;a=-4;var w=u=16}else if(e.encoding.U)t="\\U",q="000000",a=-8,u=16;else if(e.encoding.E)t="\\u",q="",a=0,n="{",f="}",u=16;else if(e.encoding.o)t="0o",u=8,h=" ";else if(e.encoding.b)t="0b",u=2,q="0000000",h=" ",a=-8;else if(e.encoding.B||e.encoding["6"])t="0b",u=2,q="000000000000000",h=" ",a=-16,w=16;else if(e.encoding.h||e.encoding.H)a=-2,q="0",t="0x",u=16,h=" ";else if(e.encoding.W||e.encoding.w)a=-2,q="0",t="%",u=16;for(c=0;c<b.length;c++){var v=b.charCodeAt(c),y;e.W?y=/[\u0000-\u001f\u005c\u007f\s\b]/:y=/[\u0000-\u001f\u005c\u007f]/;128>v?/^\\/.test(t)&&/[\s|\b|\\]/.test(b[c])&&!e.A?/^\\/.test(t)&&"\\"==b[c]?l.push("\\\\"):e.e?l.push(b[c].replace(/[\s|\b]/g,function(x){switch(x){case " ":return" ";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case "\v":return"\\v"}})):e.W?(v=t+n+(q+v.toString(u)).slice(a)+f,l.push(v+h)):l.push(b[c]):e.encoding.b||e.encoding.B||e.encoding["6"]||e.encoding.o||e.encoding.h||e.encoding.H||e.encoding.w||e.encoding.W||(e.encoding.U||e.encoding.E||e.encoding.O||e.encoding["0"]||e.encoding.u||e.encoding.x)&&(y.test(b[c])||e.A)?/[\s|\b]/.test(b[c])&&e.U?l.push(b[c]):(v=t+n+(q+v.toString(u)).slice(a)+f,l.push((e.encoding.B?v.slice(0,8)+"_"+v.slice(8):v)+h)):l.push(b[c]):e.encoding?16===w?(v=(q+v.toString(u)).slice(a),l.push(t+(e.encoding.B?v.slice(0,8)+"_"+v.slice(8):v)+h)):e.encoding.U||e.encoding.E?55296>v||57344<=v?l.push(t,n,(q+v.toString(16)).slice(a),f):(c++,l.push(t,n,(q+(1024*(v-55296)+b.charCodeAt(c)-56320+65536).toString(16)).slice(a),f)):2048>v?l.push(t,(192|v>>6).toString(u),h,t,(128|v&63).toString(u),h):55296>v||57344<=v?l.push(t,(224|v>>12).toString(u),h,t,(128|v>>6&63).toString(u),h,t,(128|v&63).toString(u),h):(c++,v=65536+((v&1023)<<10|b.charCodeAt(c)&1023),l.push(t,(240|v>>18).toString(u),h,t,(128|v>>12&63).toString(u),h,t,(128|v>>6&63).toString(u),h,t,(128|v&63).toString(u),h)):l.push(b[c])}b=l.join("");e.encoding.H&&(b=b.toUpperCase())}else if(b.constructor===Number)if(-1===Math.sign(b)?(a="-",b*=-1):a="",Infinity===b)b=e.I?a+"Infinity":e.n?"null":"";else if(e.encoding.b||e.encoding.B||e.encoding["6"]){b=Math.floor(b).toString(2);e.encoding.b?l=h=8:e.encoding.B?(h=16,l=8):e.encoding["6"]&&(l=h=16);t=b.length+(b.length<h?h-b.length:0!=b.length%h?h-b.length%h:0);if(e.encoding.b)b=("0000000"+b).slice(-t);else if(e.encoding.B||e.encoding["6"])b=("000000000000000"+b).slice(-t);t=0;for(u="";t<b.length;t+=l)u=u+(0===t?"":"_")+b.slice(t,t+l);b=a+"0b"+u}else e.encoding.h||e.encoding.H?b=a+"0x"+((16>b?"0":"")+(e.encoding.h?Math.floor(b).toString(16):Math.floor(b).toString(16).toUpperCase())):e.encoding.o?b=a+"0o"+Math.floor(b).toString(8):e.encoding.O&&(b=a+"0"+Math.floor(b).toString(8));p=[m+b]}else e.R||e.J?p=[m+k+(e.C?c:"")]:"string"!==typeof b||n?p=[k+"="+b]:(b=b.replace(e.u?/[\u0000-\u001f\u007f-\uffff|\\|"|']/g:/[\u0000-\u001f\u007f|\\|"|']/g,function(x){switch(x){case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";case "\\":return"\\\\";case '"':return"'"===r?'"':'\\"';case "'":return"'"===r?"\\'":"'";default:return"\\u"+("0000"+x.charCodeAt(0).toString(16)).slice(-4)}}),p=[k+"="+r+b+r]);return p.flat()}function objectifyExpressions(b,k){function e(d){d=d.split("");for(var g=!1,r=!1,p=!1,m=!1,c=!1,n=!1,q,f=!1,a=0,l=[],h=0;h<d.length;h++){c&&!/[$_A-Za-z0-9.]/.test(d[h])&&(c=!1);if(g||r)p?p=!1:'"'===d[h]&&g?g=!1:"'"===d[h]&&r?r=!1:"\\"===d[h]&&(p=!0);else if(m)p?p=!1:"["===d[h]?n=!0:"]"===d[h]?n=!1:"/"!==d[h]||n?"\\"===d[h]&&(p=!0):m=!1;else if(c)q=h;else if('"'===d[h]||"'"===d[h])'"'===d[h]?g=!0:r=!0,q=h;else if("$"===d[h]||"@"===d[h])q=h,"."===d[h+1]&&(c=!0,q=h);else if("]"===d[h])q=h,n=!1,"."===d[h+1]&&(c=!0,h++);else if("/"===d[h])m=!0;else if(("="===d[h]||"!"===d[h]||"<"===d[h]||">"===d[h]||"="===d[h])&&"="===d[h+1])q=void 0,h+=1,f=!0;else if("<"===d[h]||">"===d[h])q=void 0,f=!0;else if("="===d[h]&&"~"===d[h+1])q=void 0,f=!0,h+=1;else if("&"===d[h]&&"&"===d[h+1]||"|"===d[h]&&"|"===d[h+1]){if(1!=f&&void 0!==q&&(d.splice(q+1,0,"!==undefined"),h++),f=!1,a)for(var t=0;t<a;a--)d.splice(h,0,")"),h++}else if("!"===d[h])d.splice(h+1,0,"("),a++,h++;else if("("===d[h])l.unshift(a),a=0;else if(")"===d[h]){if(a)for(t=0;t<a;a--)d.splice(h+1,0,")"),h++;a=l.shift()}if(h==d.length-2&&(1!=f&&void 0!==q&&(d.splice(q+1,0,"!==undefined"),h++),a))for(t=0;t<a;a--)d.splice(h+1,0,")"),h++}return d.join("")}k=k||{};try{b=b.map(function(d){var g=[],r=!1,p=[];d=d.replace(/^\s*/,"").replace(/\s*$/,"");"."===d&&(k.c&&printErr("jq-style query '.' treated as JSONPath '$'"),d="$");if(""===d||"/"===d[0]){if(/~[^0-1]/g.test(d+" "))throw new SyntaxError("JSON Pointer allows ~0 and ~1 only: "+d);k.allowExpressions=!1;g=d.split("/");g.shift();g=g.map(function(z){return z.replace(/~1/g,"/").replace(/~0/g,"~")});"-"===g[g.length-1]&&(g[g.length-1]={expression:"-"})}else{"."===d[0]&&"["===d[1]?(d="$"+d.slice(1),k.c&&printErr("jq-style '.[' beginning, treated as JSONPath '$['")):"."===d[0]&&"."!==d[1]||"["===d[0]?(d="$"+d,k.c&&printErr("Query lacks root '$', trying as JSONPath...")):"$"!==d[0]&&(k.c&&printErr("Query lacks root '$', trying as keypath..."),d="$"+d.replace(/\\\./g,"\udead").split(".").map(function(z){return"["+JSON.stringify(z.replace(/\uDEAD/g,"."))+"]"}).join(""));var m=d.split("").reverse().join("");m=m.replace(/(["'])(.*?)\1(?!\\)|(\/.*?\/(?!\\)\s*~=)|=~*\s(\/.*?\/(?!\\))|(={2,3})[^=]|[^=](==?!)|[^=]((?:=!|=<|=>|~=))/g,function(z){return z.replace(/./g," ")});var c=/=/g;p=[];var n=0,q=[];do{q=c.exec(m);if(null===q||0===c.lastIndex||n===c.lastIndex)break;n=c.lastIndex;p.unshift(n)}while(0!==c.lastIndex&&c.lastIndex!==m.length);if(k.disallowData&&p.length)throw new SyntaxError("Data assignment (=) not allowed in path specification");if(1<p.length)throw new SyntaxError("Multiple assignment operators detected: "+d);if(0<d.length-n)m=d.substring(0,d.length-n).split("").reverse().join("");else throw Error("Error parsing: "+d);q=0;c=/([\w\d$]*[A-Za-z_$])(\.{1,2})|(\*?)(\.{1,2})|(\])|(\$)/g;do{var f=c.exec(m);if(null===f)break;if(q+f[0].length!==c.lastIndex||""===f[0])throw new SyntaxError("Malformed path expression: "+d);if(f[1]||f[3]){if(r)throw new SyntaxError("Additional operators (./..) disallowed after recursive descent: "+d);f=f.filter(function(z){return null!=z});if("*"===f[1]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);g.unshift({expression:"*"})}else f[1]&&g.unshift(f[1].split("").reverse().join(""));if(".."===f[2]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);g.unshift({expression:".."})}else if(""===f[1]){c.lastIndex=q;break}}else if(f[4]){if("."===f[4])break;else if(!g.length){r=!0;break}else if(".."===g[0].expression)throw new SyntaxError("Additional operators (./..) disallowed after recursive descent: "+d);g.unshift({expression:".."})}else if(f[5]){r=!1;q=/\s*(["'])(.*?)\1(?!\\)|(\*(?!:\*))|(\d+\-?)|(-)|(,)|(:)|(\))|(\[)|\s/g;f=[];var a=[],l=c.lastIndex,h=[],t=!1,u=!1,w=!1;q.lastIndex=c.lastIndex;do{a=q.exec(m);if(null===a||l===q.lastIndex||l+a[0].length!==q.lastIndex)throw new SyntaxError("Malformed path expression : "+d);a=a.map(function(z){return z?z.split("").reverse().join(""):z});if(""===a[2])f.unshift(a[2]);else if(a[2]){if(u){q.lastIndex=l;break}else u=!0;if(t)break;h.unshift(JSON.parse('"'+("'"===a[1]?a[2].replace(/\\'/g,"'").replace(/"/g,'\\"'):a[2])+'"',null,0))}else if(a[3]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);if(u){q.lastIndex=l;break}else u=!0;if(t)break;else h.unshift({expression:"*"})}else if(a[4]){if(u&&!w){q.lastIndex=l;break}else u=!0;w&&t&&(t=!1);if("0"!==a[4]&&("0"===a[4][0]||"-"===a[4][0]&&"0"===a[4][1]))throw Error("Octal indices are disallowed: "+a[4]);h.unshift(Number(a[4]))}else if(a[5]){if(u){q.lastIndex=l;break}else u=!0;h.unshift({expression:"-"})}else if(a[6]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);h.length&&!w?f.unshift(h[0]):h.length&&(w&&t&&h.unshift(null),f.unshift({expression:h}));h=[];u=!1;w&&(w=t=!1)}else if(a[7]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);w=!0;if(1===h.length&&null!==h[0]&&(h[0].constructor===String||h[0].constructor!==Number&&"("!==h[0].expression[0]))break;h.length&&!t||h.unshift(null);t||=!0}else if(a[8]){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);l=0;var v=1,y=[];a=a[8];var x=/(["'])(.*?)\1(?!\\)|(\()|(\))|(\/.*?\/(?!\\)\s*~=)|(~=\s*\/.*?\/(?!\\))|(==?((?:=|!)))|(.)/g;if(w)t=!1;else if(u)break;x.lastIndex=q.lastIndex;do{y=x.exec(m);if(y[1])a+=y[0].replace(/@/g,"@\\");else if(y[3])a+=y[3],l+=1;else if(y[4])a+=y[4],v+=1;else if(y[5]||y[6])a+=y[0].replace(/@/g,"@\\");else if(y[7])a+="=="+y[8];else if(y[9]){if("="===y[9]&&!/[<>!]/.test(m[x.lastIndex]))break;a+=y[9]}if(v===l){u=!0;if("?"===m[x.lastIndex]){if(w){x.lastIndex=0;break}a+="?";x.lastIndex+=1}q.lastIndex=x.lastIndex;y=e(a.split("").reverse().join(""));h.unshift({expression:y});break}}while(0!==x.lastIndex&&x.lastIndex!==m.length);if(v!==l)break}else if(a[9]){1!==q.lastIndex-c.lastIndex&&(c.lastIndex=q.lastIndex);break}l=q.lastIndex}while(0!==q.lastIndex&&q.lastIndex!==m.length);1!==h.length||w?h.length&&(w&&t&&h.unshift(null),void 0===h[2]&&(h[2]=null),f.unshift({expression:h})):f.unshift(h[0]);if(1<f.length){if(!k.allowExpressions)throw new SyntaxError("JSONPath expressions disallowed: "+d);g.unshift(f)}else g.unshift(f[0])}else if(f[6])if(c.lastIndex===m.length)var A=!0;else break;q=c.lastIndex}while(0!==c.lastIndex&&c.lastIndex!==m.length);if(!A||r||c.lastIndex!==m.length&&!n)throw new SyntaxError("Malformed path expression: "+d);}if(1===p.length){if("="===d.charAt(d.length-n-1))return"";d=d.substring(d.length-n+1,d.length);d.match(/^'(.*)'$/)&&(d='"'+d.substring(1,d.length-1).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/"/g,'\\"')+'"');try{var B=JSON.parse(d)}catch(z){throw new SyntaxError(z+": "+d);}}if(g.length&&g[g.length-1].constructor===Array&&k.expandTrailingUnion)for(d=[],g=g.slice(),r=g.pop(),p=0;p<r.length;p++)n=r[p],A=g.slice(),A.push(n),d.push({path:A,data:B});else d={path:g,data:B};return d})}catch(d){throw Error(d);}return b.filter(function(d){return d}).flat()}function sortObject(b){if(Array.isArray(b))var k=[];else if("object"===typeof b&&null!==b)k={};else return b;return Object.keys(b).sort().reduce(function(e,d){e[d]="object"===typeof b[d]?sortObject(b[d]):b[d];return e},k)}function flatten(){for(var b=[],k=0;k<arguments.length;k++)arguments[k]instanceof Array?b.push.apply(b,flatten.apply(this,arguments[k])):b.push(arguments[k]);return b}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function flat(b){var e=isNaN(b)?1:Number(b);return e?Array.prototype.reduce.call(this,function(d,g){Array.isArray(g)?d.push.apply(d,flat.call(g,e-1)):d.push(g);return d},[]):Array.prototype.slice.call(this)},writable:!0});Object.defineProperty(Array.prototype,"sortVarWidth",{configurable:!0,value:function(){var b=this,k=Array.prototype.map.call(this,function(d){return d.length}).filter(function(d,g,r){return g==r.indexOf(d)}).sort(function(d,g){return d-g}),e=[];Array.prototype.forEach.call(k,function(d){var g=Array.prototype.filter.call(b,function(r){return r.length==d});e.push(g.sort())});return e.flat()},writable:!0});RegExp.quote=function(b){return b.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};Math.sign||(Math.sign=function(b){return(0<b)-(0>b)||+b});(function(b,k){"object"===typeof exports?k(module.exports):"function"===typeof define&&define.amd?define(["exports"],k):(b.jsonpatch={},b.returnExports=k(b.jsonpatch))})(this,function(b){function k(f){Error.call(this,f);this.message=f}function e(f){Error.call(this,f);this.message=f}function d(f){var a;if(n(f))return f.slice();if(null===f)return f;if("object"===typeof f){var l={};for(a in f)Object.hasOwnProperty.call(f,a)&&(l[a]=f[a]);return l}return f}function g(f,a){var l;if(f===a)return!0;if(typeof f!==typeof a)return!1;if("object"===typeof f){var h=n(f),t=n(a);if(h!==t)return!1;if(h){if(f.length!=a.length)return!1;for(l=0;l<f.length;l++)if(!g(f[l],a[l]))return!1;return!0}if(Object.keys(f).length!==Object.keys(a).length)return!1;for(l in f)if(!a.hasOwnProperty(l)||!g(f[l],a[l]))return!1;return!0}return!1}function r(f){var a;if(!f.op)throw new k("Operation missing");if(!q.hasOwnProperty(f.op))throw new k("Invalid JSON Patch operation");if(!("path"in f))throw new k("Path missing");var l=q[f.op];for(a=0;a<l.length;a++)if(void 0===f[l[a]])throw new k(f.op+" must have key "+l[a]);}function p(f,a){r(f);var l=f.op,h=new c(f.path),t=f.value,u=void 0!==f.from?new c(f.from):null;switch(l){case "add":return function(w){return h.add(w,t,a)};case "remove":return function(w){return h.remove(w,a)};case "replace":return function(w){return h.replace(w,t,a)};case "move":if(h.subsetOf(u))throw new k("destination must not be a child of source");return function(w){var v=u.get(w);w=u.remove(w,a);return h.add(w,v,a)};case "copy":return function(w){var v=u.get(w);return h.add(w,v,a)};case "test":return function(w){if(!g(h.get(w),t))throw new e("Test operation failed. Values did not match.");return w}}}var m,c;var n=Array.isArray||function(f){return"[object Array]"==Object.prototype.toString.call(f)};b.apply_patch=function(f,a){return(new m(a)).apply(f)};b.InvalidPatch=k;k.prototype=Error();b.PatchApplyError=e;e.prototype=Error();b.JSONPointer=c=function(f){var a=[];var l=f.split("/");if(""!==l[0])throw new k("JSONPointer must start with a slash (or be an empty string)!");for(f=1;f<l.length;f++)a[f-1]=l[f].replace(/~1/g,"/").replace(/~0/g,"~");this.path=a;this.length=a.length};c.prototype._get_segment=function(f,a){f=this.path[f];if(n(a))if("-"===f)f=a.length;else{if(!f.match(/^0$|^[1-9][0-9]*$/))throw new RangeError("Invalid array index: "+f);f=parseInt(f,10)}return f};c.prototype._action=function(f,a,l){function h(u,w){l||(u=d(u));var v=t._get_segment(w,u);if(w==t.path.length-1)u=a(u,v);else{if(n(u)){if(u.length<=v)throw new e("Path not found in document");}else if("object"===typeof u){if(!Object.hasOwnProperty.call(u,v))throw new e("Path not found in document");}else throw new e("Path not found in document");w=h(u[v],w+1);l||(u[v]=w)}return u}var t=this;return h(f,0)};c.prototype.add=function(f,a,l){return 0===this.length?a:this._action(f,function(h,t){if(null===h)throw Error("Unable to add to null!");if(n(h)){if(t>h.length)throw new RangeError("Array index '"+t+"' does not exist. Use '-' to add to the end.");h.splice(t,0,a)}else h[t]=a;return h},l)};c.prototype.remove=function(f,a){return 0===this.length?[]:this._action(f,function(l,h){if(!Object.hasOwnProperty.call(l,h))throw new e("Remove operation must point to an existing value!");n(l)?l.splice(h,1):delete l[h];return l},a)};c.prototype.replace=function(f,a,l){return 0===this.length?a:this._action(f,function(h,t){if(null===h)throw Error("Unable to replace to null!");if(!Object.hasOwnProperty.call(h,t))throw new RangeError("Replace requires an existing location. Property '"+t+"' not found.");n(h)?h.splice(t,1,a):h[t]=a;return h},l)};c.prototype.get=function(f){var a;if(0===this.length)return f;this._action(f,function(l,h){if(!Object.hasOwnProperty.call(l,h))throw new e("Path not found in document");a=l[h];return l},!0);return a};c.prototype.subsetOf=function(f){if(this.length<=f.length)return!1;for(var a=0;a<f.length;a++)if(f.path[a]!==this.path[a])return!1;return!0};var q={add:["value"],replace:["value"],test:["value"],remove:[],move:["from"],copy:["from"]};b.JSONPatch=m=function(f,a){this._compile(f,a)};m.prototype._compile=function(f,a){var l;this.compiledOps=[];"string"===typeof f&&(f=JSON.parse(f));if(!n(f))throw new k("Patch must be an array of operations");for(l=0;l<f.length;l++){var h=p(f[l],a);this.compiledOps.push(h)}};b.JSONPatch.prototype.apply=function(f){var a;for(a=0;a<this.compiledOps.length;a++)f=this.compiledOps[a](f);return f}});function isObject(b){var k=typeof b;return null!=b&&("object"===k||"function"==k)}function diff(b,k){if(b!=k){if(null==b||null==k||"object"!==typeof k||"object"!==typeof b)return null!=k?k:null;if(!Array.isArray(b)&&Array.isArray(k))return k;if(Array.isArray(b)&&!Array.isArray(k))return k=JSON.parse(JSON.stringify(k)),k.length=null,k;var e=void 0,d;for(d in b)if(b.hasOwnProperty(d))if(k.hasOwnProperty(d)){var g=diff(b[d],k[d]);void 0!==g&&(null==e&&(e={}),e[d]=g)}else null==e&&(e={}),e[d]=null;for(d in k)k.hasOwnProperty(d)&&!b.hasOwnProperty(d)&&(null==e&&(e={}),e[d]=k[d]);if(Array.isArray(b)&&Array.isArray(k)&&k.length<b.length)for(k=e.length=k.length;k<b.length;k++)delete e[k];return e}}function merge(b,k,e,d){Array.isArray(b)&&null!=k&&null===k.length&&(b={},delete k.length);if(null==k||null!=k&&k.constructor!==Object)return Array.isArray(k)?JSON.parse(JSON.stringify(k)):k;isObject(b)||(b={});var g=!1,r;for(r in k){var p=k[r];e&&null==p?(g=!0,delete b[r]):void 0===b[r]&&d&&1==d.existingOnly||void 0!==b[r]&&d&&1==d.nonexistingOnly||(b[r]=merge(b[r],p,e,d))}if(g&&Array.isArray(b))for(k=b.length;0<k;k--)null==b[k-1]&&(b.length=k-1);return b}function ingestLiterals(b,k,e){b=b.split("\n").filter(function(n){return null!=n&&""!=n});try{var d=objectifyExpressions(b)}catch(n){throw Error(n);}for(b=0;b<d.length;b++){var g=d[b],r=g.path;g=g.data;var p=e;if(r.length){r[0].constructor!==String||void 0!==e&&null!==e&&e.constructor===Object?r[0].constructor!==Number||void 0!==e&&null!==e&&e.constructor===Array||(void 0!==e&&k.G?printErr("Guarding $["+r[0]+"] from changing object to array, line: "+(b+1)):p=e=[]):void 0!==e&&k.G?printErr("Guarding $["+r[0]+"] from changing array to object, line: "+(b+1)):"-"!==r[0]&&(p=e={});for(var m=0;m<=r.length-1;m++){var c=p.constructor!==Array||"-"!==r[m].expression&&"-"!==r[m]?r[m]:p.length;if(void 0===g&&!k.g||void 0===c)break;m===r.length-1?void 0!==p[c]&&k.G?printErr("Guarding against re-assignment of '"+c+"' to: "+JSON.stringify(g)):void 0!==g?p[c]=g:k.g&&(p[c]=null):(p.hasOwnProperty(c)?r[m+1].constructor!==String||void 0!==p[c]&&null!==p[c]&&p[c].constructor===Object?r[m+1].constructor!==Number||void 0!==p[c]&&null!==p[c]&&p[c].constructor===Array||(p[c]=[]):p[c]={}:r[m+1].constructor===String?p[c]={}:r[m+1].constructor===Number&&(p[c]=[]),p=p[c])}}else void 0!==e&&k.G?printErr("Guarding $ from root overwrite, line: "+(b+1)):void 0!==g?e=g:k.g&&(e=null)}return void 0!==e?JSON.parse(JSON.stringify(e)):[]}function alterObject(b,k,e,d,g,r,p){if(!g.x&&!g.X){var m,c=[];void 0!==Object.keys(g.opArg)[0]&&(m=Object.keys(g.opArg)[0]);if(void 0!==k){if(g.V)try{k=readFile(k)}catch(l){throw Error(l);}g.s&&(k='"'+k.replace(/[\u0000-\u001f\u007f|"|\\]/g,function(l){switch(l){case '"':return'\\"';case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";default:return"\\u"+("0000"+l.charCodeAt(0).toString(16)).slice(-4)}})+'"');try{k=JSON.parse(k)}catch(l){g.c&&g.H&&printErr("Truncation help will be attmepted on value input (-v/-V)");var n=rehabJSON(k);if(!n.length||1<n.length)throw Error("Multiple JSON texts are not allowed in as a value");try{k=JSON.parse(n[0])}catch(h){throw printErr("Error in supplied JSON value (-v/-V): "+n[0].substring(0,24).replace(/[\n|\r]/g,"")+"\u2026"),Error(l);}}}if(void 0!==e)if("$"===e)var q="";else if("$"===e[0]){try{q=jsonPath(b,objectifyExpressions([e],null)[0].path,{resultType:"PATH_JSONPOINTER"})}catch(l){throw Error(l);}if(q.length){if(1<q.length)throw new RangeError('Error: "From" path returned multiple results: '+e+"\n"+q.join("\n"));q=q[0]}else throw Error("Unable to resolve from path: "+e);}else q=e;if(void 0!==d)if("$"===d)c=[""];else if("$"===d[0]){try{c=objectifyExpressions([d],{expandTrailingUnion:!0,allowExpressions:!0})}catch(l){throw Error(l);}c=c.map(function(l){try{var h=jsonPath(b,l.path,{resultType:"PATH_JSONPOINTER"})}catch(u){throw Error(u);}if(h.length)return h;if(g.opArg.remove||g.opArg.replace||g.opArg.test)return g.G?"/"+l.path.map(function(u){return u.toString().replace(/~/g,"~0").replace(/\//g,"~1")}).join("/"):"";h=l.path.slice();var t=h.pop();if(h.length||"-"!==t.expression)if(h.length){l=jsonPath(b,h,{resultType:"PATH_OBJECT"});if(!l.length)return"";l=l.map(function(u){u.path.push("-"===t.expression?"-":t);return null===t||t.constructor!==String&&t.constructor!==Array&&"-"!==t.expression?"":"/"+u.path.map(function(w){return w.toString().replace(/~/g,"~0").replace(/\//g,"~1")}).join("/")})}else l="/"+l.path.map(function(u){return u.toString().replace(/~/g,"~0").replace(/\//g,"~1")}).join("/");else l="/-";return l}).flat().sortVarWidth().reverse().filter(function(l){return null!=l&&""!=l}).filter(function(l,h,t){return!h||l!=t[h-1]});if(1<c.length&&g.opArg.move)throw Error("Move operation cannot have multiple destinations: "+d+"\n"+c.join("\n"));}else if(""===d||"/"===d[0])c=[d];else throw SyntaxError("Unrecognized query syntax: "+d);}if(g.opArg.mergepatch||g.opArg.merge||g.opArg.merge0||g.opArg.merge1){if(void 0!==k&&void 0!==q)throw Error("Merge source ambiguous. Specify a value (-v/-V) or a path (-p), or neither.");if(void 0===k&&void 0===q)throw new SyntaxError("Merge source not given, specify a path (-p) or a JSON value (-v/-V).");if(q){try{var f=jsonPath(b,objectifyExpressions([q])[0].path,null)[0]}catch(l){throw Error(l);}k=f;if(void 0===k)throw Error("From path does not exist: "+q);}else""===q&&(k=jsonPath(b,[],null)[0]);c.length?c.forEach(function(l){try{var h=jsonPath(b,objectifyExpressions([l])[0].path,null)[0]}catch(t){throw Error(t);}h=merge(h,k,g.opArg.mergepatch?!0:!1,g.opArg.merge1?{existingOnly:!0}:g.opArg.merge0?{nonexistingOnly:!0}:null);try{b=jsonpatch.apply_patch(b,[{op:"replace",path:l,value:h}])}catch(t){throw Error(t);}}):b=merge(b,k,g.opArg.mergepatch?!0:!1,g.opArg.merge1?{existingOnly:!0}:g.opArg.merge0?{nonexistingOnly:!0}:null)}else if(g.opArg.diff)if(void 0!==k)b=diff(b,k,!0);else throw new SyntaxError("No value specified!");else{if(g.x||g.X){m=g.X?readFile(p):p;try{var a=JSON.parse(m)}catch(l){g.c&&g.H&&printErr("Truncation help will be attmepted on JSON Patch input");n=rehabJSON(m);if(1<n.length)throw Error("Multiple JSON texts are not allowed for JSON Patch");if(!n.length)throw Error("No JSON supplied for JSON Patch!");try{a=JSON.parse(n[0])}catch(h){throw printErr("Error in supplied JSON Patch input: "+n[0].substring(0,24).replace(/[\n|\r]/g,"")+"\u2026"),Error(l);}}}else if(c.length)for(a=[{}],e=0;e<c.length;e++)a[e]={op:m,path:c[e],from:q,value:k};else throw Error("JSON Patch operation with no path provided!");try{b=jsonpatch.apply_patch(b,a)}catch(l){throw Error("JSON Text ("+r+") "+l);}}return b}function rehabJSON(b){b=b.split("");for(var k=!1,e=!1,d=!1,g=!1,r=!1,p=!1,m=0,c=[],n=!1,q=[],f,a=0,l=b.length;a<l;a++){if(k||e)if(d)if(d=!1,"0"===b[a]&&!/\d/.test(b[a+1]))option.c&&printErr("Byte "+(a+1)+": null notation \\0 (JSON5)"),b[a]="u0000";else if("v"===b[a])option.c&&printErr("Byte "+(a+1)+": vertical tab \\v (JSON5)"),b[a]="u000b";else if("x"===b[a]&&/\d|[A-Fa-f]/.test(b[a+1])&&/\d|[A-Fa-f]/.test(b[a+2]))option.c&&printErr("Byte "+(a+1)+": hex notation \\x (JSON5)"),b[a]="u00",a+=2;else if("\r"===b[a]&&"\n"===b[a+1])option.c&&printErr("Byte "+(a+1)+": \\ escaped newlines (\\r\\n) (JSON5)"),b[a]="",b[a+1]="",a+=1;else{if("\n"===b[a]||"\r"===b[a]||"\u2028"===b[a]||"\u2029"===b[a])option.c&&printErr("Byte "+(a+1)+": \\ escaped newline in string (JSON5)"),b[a]=""}else if('"'===b[a]&&k||"'"===b[a]&&e)e?(e=!1,b[a]='"'):k=!1,c.length?f=a:n=!0;else if('"'===b[a]&&e)b[a]='\\"';else if("\\"===b[a])d=!0,f=a,"\n"===b[a+1]||"\r"===b[a+1]&&"\n"===b[a+2]?b[a]="":"'"===b[a+1]&&(b[a]="");else if("\t"===b[a])option.c&&printErr("Byte "+(a+1)+": literal tab character in string"),b[a]="";else{if("\n"===b[a])if(option.c&&printErr("Byte "+(a+1)+": literal newline in quotes"),option.w)option.c&&printErr("Ignoring newline (-w)"),b[a]="";else{if(option.H)if(option.c&&printErr("Truncation help for JSON Text ("+(q.length+1)+"), bytes: "+(m+1)+"-"+(a+1)),b[a]="",k=e=!1,c.length){for(n=0;n<c.length;n++)"Object"===c[n].type?"NEEDS_NAMESEP"===c[n].state?(option.c&&(0===n?printErr("Truncation help after byte "+a+', open string, missing separator, value, object end: ":null}'):printErr("Truncation help after byte "+a+", missing separator, value, object end: :null}")),b[a]+=(0===n?'"':"")+":null}"):"NEEDS_ENDER"===c[n].state&&(option.c&&(0===n?printErr("Truncation help after byte "+a+', open string and object end: "}'):printErr("Truncation help after byte "+a+", object end: }")),b[a]+=(0===n?'"':"")+"}"):"Array"===c[n].type&&"NEEDS_ENDER"===c[n].state&&(option.c&&(0===n?printErr("Truncation help after byte "+a+', open string and array end: "]'):printErr("Truncation help after byte "+a+", array end: ]")),b[a]+=(0===n?'"':"")+"]");c=[]}else option.c&&printErr("Truncation help after byte "+a+", open string"),b[a]+='"';n=!0}}else if(p){if("\n"===b[a]||"\r"===b[a]||"\u2028"===b[a]||"\u2029"===b[a])p=!1;b[a]=""}else if(g)"*"===b[a]&&"/"===b[a+1]?(b[a]="",b[a+1]="",a+=1,g=!1):b[a]="";else if(r)"-"===b[a]&&"-"===b[a+1]&&">"===b[a+2]?(b[a]="",b[a+1]="",b[a+2]="",a+=2,r=!1):b[a]="";else if(/[\s\ufefe]/.test(b[a])){option.c&&!/[ \n\r\t]/g.test(b[a])&&option.c&&printErr("Byte "+(a+1)+": additional whitespace character +("+JSON.stringify(b[a],null,0)+") (JSON5)");/[\f\r\v\u2028\u2029]/g.test(b[a])?"\r"===b[a]&&"\n"===b[a+1]?a+=1:b[a]="\n":/[^ \n]/g.test(b[a])&&(b[a]=" ");if(void 0===f){m=a+1;continue}if(!c.length&&void 0!==f||a===l-1)n=!0}else if('"'===b[a]||"'"===b[a])'"'===b[a]?k=!0:(e=!0,b[a]='"',option.c&&printErr("Byte "+(a+1)+": single quoted string (JSON5)")),c.length&&(c.length&&"Object"===c[0].type?"OBJECT_BEGIN"===c[0].state||"NEEDS_PROPNAME"===c[0].state?c[0].state="NEEDS_NAMESEP":"NEEDS_VALUE"===c[0].state&&(c[0].state="NEEDS_ENDER"):!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER")),f=a;else if(":"===b[a])c.length&&"Object"===c[0].type&&"NEEDS_NAMESEP"===c[0].state&&(c[0].state="NEEDS_VALUE"),f=a;else if("{"===b[a])option.D&&c.length&&("\n"===b[a-1]||"NEEDS_VALUE"!==c[0].state&&"ARRAY_BEGIN"!==c[0].state)?(--a,option.c&&printErr("Byte "+(a+1)+": Truncation Detected"),n=!0):(c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"),c.unshift({type:"Object",state:"OBJECT_BEGIN"}),f=a);else if("["===b[a])option.D&&c.length&&("\n"===b[a-1]||"NEEDS_VALUE"!==c[0].state&&"ARRAY_BEGIN"!==c[0].state)?(--a,option.c&&printErr("Byte "+(a+1)+": Truncation Detected"),n=!0):(c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"),c.unshift({type:"Array",state:"ARRAY_BEGIN"}),f=a);else if("}"===b[a])","===b[f]&&(option.c&&printErr("Byte "+(f-1)+": trailing comma (JSON5)"),b[f]=""),c.shift(),c.length?f=a:n=!0;else if("]"===b[a])","===b[f]&&(option.c&&printErr("Byte "+(f-1)+": trailing comma (JSON5)"),b[f]=""),c.shift(),c.length?f=a:n=!0;else if(","===b[a])f=a,c.length&&"Object"===c[0].type&&"NEEDS_ENDER"===c[0].state?c[0].state="NEEDS_PROPNAME":c.length&&"Array"===c[0].type&&"NEEDS_ENDER"===c[0].state&&(c[0].state="NEEDS_VALUE");else if("n"===b[a]&&"u"===b[a+1]&&"l"===b[a+2]&&"l"===b[a+3]||"t"===b[a]&&"r"===b[a+1]&&"u"===b[a+2]&&"e"===b[a+3]||"f"===b[a]&&"a"===b[a+1]&&"l"===b[a+2]&&"s"===b[a+3]||"e"===b[a+4]){c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER");var h=b.slice(a,a+5).join("");if("true"===h.slice(a,a+4)||"true"===h.slice(a,a+4))f=a+4;"false"===h.slice(a,a+5)&&(f=a+5)}else if("+"===b[a]&&(/\d/.test(b[a+1])||"."===b[a+1]))option.c&&printErr("Byte "+(a+1)+": explicit plus + for value (JSON5)"),c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"),b[a]="";else if("."===b[a]&&!/\d/.test(b[a-1]))option.c&&printErr("Byte "+(a+1)+": decimal point wihtout preceding digit (JSON5)"),c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"),b[a]="0.",f=a;else if("."===b[a]&&!/\d/.test(b[a+1]))option.c&&printErr("Byte "+(a+1)+": trailing decimal lacking mantissa (JSON5)"),b[a]="";else if("N"===b[a]&&"a"===b[a+1]&&"N"===b[a+2]&&(!c.length||"Object"===c[0].type&&"{"!==b[f]&&","!==b[f]||"Array"===c[0].type))option.c&&printErr("Byte "+(a+1)+": NaN for value (JSON5)"),option["8"]?(b[a]='"',b[a+1]="NaN",b[a+2]='"'):(b[a]="",b[a+1]="",b[a+2]="null"),f=a+=2;else if("-"!==b[a]&&"+"!==b[a]||"I"!==b[a+1]||"n"!==b[a+2]||"f"!==b[a+3]||"i"!==b[a+4]||"n"!==b[a+5]||"i"!==b[a+6]||"t"!==b[a+7]||"y"!==b[a+8])if("I"===b[a]&&"n"===b[a+1]&&"f"===b[a+2]&&"i"===b[a+3]&&"n"===b[a+4]&&"i"===b[a+5]&&"t"===b[a+6]&&"y"===b[a+7])option.c&&printErr("Byte "+(a+1)+": Infinity as value (JSON5)"),b[a]="",b[a+1]="",b[a+2]="",b[a+3]="",b[a+4]="",option.I?(b[a+5]='"',b[a+6]="Infinity",b[a+7]='"'):(b[a+5]="",b[a+6]="",b[a+7]="null"),a+=4;else if("0"!==b[a]||"x"!==b[a+1]||c.length&&"Array"!==c[0].type&&("Object"!==c[0].type||":"!==b[f]))if("-"===b[a]||/\d/.test(b[a]))c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"),/\d/.test(b[a])&&(f=a);else if(/[$_A-Za-z]/.test(b[a])&&c.length&&"Object"===c[0].type&&("{"===b[f]||","===b[f])){option.c&&printErr("Byte "+(a+1)+": unquoted object key name (JSON5)");b[a]='"'+b[a];for(a+=1;a<b.length;a++)if(/[^$_A-Za-z0-9]/.test(b[a])){--a;break}b[a]+='"';f=a;c.length&&(c.length&&"Object"===c[0].type?"OBJECT_BEGIN"===c[0].state||"NEEDS_PROPNAME"===c[0].state?c[0].state="NEEDS_NAMESEP":"NEEDS_VALUE"===c[0].state&&(c[0].state="NEEDS_ENDER"):!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER"))}else"/"===b[a]&&"*"===b[a+1]?(option.c&&printErr("Byte "+(a+1)+": /* block comment (JSON5)"),b[a]="",g=!0):"/"===b[a]&&"/"===b[a+1]?(option.c&&printErr("Byte "+(a+1)+": // line comment (JSON5)"),b[a]="",p=!0):"-"===b[a]&&"-"===b[a+1]?(option.c&&printErr("Byte "+(a+1)+": -- line comment"),b[a]="",p=!0):"<"===b[a]&&"!"===b[a+1]&&"-"===b[a+2]&&"-"===b[a+3]?(option.c&&printErr("Byte "+(a+1)+": \x3c!-- block comment"),b[a]="",r=!0):"*"===b[a]&&"*"===b[a+1]&&"*"===b[a+2]?(option.c&&printErr("Byte "+(a+1)+": *** line comment"),b[a]="",p=!0):"#"===b[a]?(option.c&&printErr("Byte "+(a+1)+": # line comment"),b[a]="",p=!0):";"===b[a]?(option.c&&printErr("Byte "+(a+1)+": ; line comment"),b[a]="",p=!0):f=a;else{h="-"===b[a-1]?a-1:a;option.c&&printErr("Byte "+(h-1)+": 0x hex value (JSON5)");for(a+=2;a<l;a++)if(!/[0-9A-Fa-f]/.test(b[a])||/\s/.test(b[a])||","===b[a]||"]"===b[a]||"}"===b[a]||" "===b[a]||"\t"===b[a]||"\r"===b[a]||"\n"===b[a]||":"===b[a]||"\ufefe"===b[a]){--a;break}f=a;var t=b.slice(h,f+1).join("");t=eval(t);for(b[f]=t;h<f;h++)b[h]="";c.length&&"Object"===c[0].type&&"NEEDS_VALUE"===c[0].state?c[0].state="NEEDS_ENDER":!c.length||"Array"!==c[0].type||"ARRAY_BEGIN"!==c[0].state&&"NEEDS_VALUE"!==c[0].state||(c[0].state="NEEDS_ENDER");f=a}else if(!c.length||"Object"===c[0].type&&"{"!==b[f]&&","!==b[f]||"Array"===c[0].type)option.c&&printErr("Byte "+(a+1)+": "+b[a]+"Infinity as value (JSON5)"),option.I?(b[a+6]='"',b[a+7]=b[a]+"Infinity",b[a+8]='"'):(b[a+6]="",b[a+7]="",b[a+8]="null"),b[a]="",b[a+1]="",b[a+2]="",b[a+3]="",b[a+4]="",b[a+5]="",a+=5;if(n){k="";if(c.length&&option.H)for(option.c&&printErr("Truncation help for JSON Text ("+(q.length+1)+"), bytes: "+(m+1)+"-"+(a+1)),n=0;n<c.length;n++)"Object"===c[n].type?"NEEDS_ENDER"===c[n].state||"OBJECT_BEGIN"===c[n].state?(option.c&&printErr("Truncation help after byte "+(a+1)+", object end: }"),k+="}"):"NEEDS_PROPNAME"===c[n].state?(option.c&&printErr("Truncation help after byte "+(a+1)+', open string, missing value and object end: "":null}'),k+='"":null}'):"NEEDS_VALUE"===c[n].state?(option.c&&printErr("Truncation help after byte "+(a+1)+", missing value and object end: null}"),k+="null}"):"NEEDS_NAMESEP"===c[n].state&&(option.c&&printErr("Truncation help after byte "+(a+1)+", missing separator,value, and object end: :null}"),k+=":null}"):"Array"===c[n].type&&("NEEDS_ENDER"===c[n].state||"ARRAY_BEGIN"===c[n].state?(option.c&&printErr("Truncation help after byte "+(a+1)+", array end: ]"),k+="]"):"NEEDS_VALUE"===c[n].state&&(option.c&&printErr("Truncation help after byte "+(a+1)+", missing value and array end: null]"),k+="null]"));q[q.length]=b.slice(m,a+1).join("")+k;if(option.c&&1===q.length)var u=m,w=a;option.c&&1<q.length&&(2===q.length&&printErr("Bytes "+(u+1)+"-"+(w+1)+": JSON Text (1)"),printErr("Bytes "+(m+1)+"-"+(a+1)+": JSON Text ("+q.length+")"));m=a+1;f=void 0;c=[];newLineCount=0;p=r=g=d=k=e=n=!1}}return q}"undefined"===typeof printErr&&eval("function printErr(string) { debug(string) }");for(var option={},maxSize={print:715827880,file:2147483647},query=decodeURIComponent(escape(arguments[0]))||"$",fileArg=decodeURIComponent(escape(arguments[1]))||"/dev/stdin",optionsArg=arguments[2]||"",i=0;i<optionsArg.length;i++)switch(optionsArg.charAt(i)){case "Q":option.Q=!0;option.q=!0;break;default:option[optionsArg.charAt(i)]=!0}var spaceArgString=decodeURIComponent(escape(arguments[3]))||"2",spaceArg=/^\s*$/.test(spaceArgString)||isNaN(spaceArgString)?spaceArgString:Number(spaceArgString);option.spaceArg=spaceArg;var valueArg=option.v||option.V?decodeURIComponent(escape(arguments[4])):void 0;if(option.p)var pathArg=decodeURIComponent(escape(arguments[5]));option.maxDepth=""===arguments[6]||isNaN(Number(arguments[6]))?-1:Number(arguments[6]);arguments[7][0]?(option.encoding={},option.encoding[decodeURIComponent(escape(arguments[7][0]))]=!0):option.encoding="";option.opArg={};option.o&&(option.opArg[decodeURIComponent(escape(arguments[8]))]=!0);if(option.f)var fromArg=decodeURIComponent(escape(arguments[9]));var JSONPatchArg=decodeURIComponent(escape(arguments[10]))||"",multiJSONArg=decodeURIComponent(escape(arguments[11]))||"";option.k&&(option.K=!0);option.K&&(option.i=!0);if("function"===typeof readFile)try{var fileText=readFile(fileArg)}catch(b){printErr("File error (note: jsc max size is "+maxSize.file+" bytes): "+b),quit()}else for(option.V&&(printErr('-V not available for this version of jsc\nUse -v "$(< file)" as a workaround'),quit()),fileText="";line=decodeURIComponent(escape(this.readline()));)fileText+=line+"\n";var JSONObjectArray=[];if(option.S){"/dev/stdin"===fileArg&&(fileText=fileText.slice(0,-1));fileText='"'+fileText.replace(/[\u0000-\u001f\u007f-\uffff|"|\\]/g,function(b){switch(b){case '"':return'\\"';case "\\":return"\\\\";case "\b":return"\\b";case "\f":return"\\f";case "\n":return"\\n";case "\r":return"\\r";case "\t":return"\\t";default:return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}})+'"';try{JSONObjectArray[0]=JSON.parse(fileText)}catch(b){printErr("JSON Input Data: "+b),quit()}}else if(/\u001e/.test(fileText)){var tempJSONArray=fileText.split("\u001e"),tempJSONArray_preRS=tempJSONArray.shift();tempJSONArray_preRS&&printErr("Error: JSON Sequence text (0) lacking leading Record Seperator (\\u001e): "+tempJSONArray_preRS);for(var j=i=0;i<tempJSONArray.length;i++)if(""!==tempJSONArray[i]&&/\S/.test(tempJSONArray[i]))if(/^\s*\$/.test(tempJSONArray[i])){try{JSONObjectArray[j]=ingestLiterals(tempJSONArray[i],option);var lastParse=1}catch(b){printErr(b),lastParse=0}lastParse&&(j+=1)}else{try{JSONObjectArray[j]=JSON.parse(tempJSONArray[i]),lastParse=1}catch(b){printErr("Error: Unable to parse JSON Sequence text ("+i+"): "+tempJSONArray[i]),lastParse=0}!lastParse||null!==JSONObjectArray[j]&&JSONObjectArray[j].constructor!==Number&&JSONObjectArray[j].constructor!==Boolean||/\s/.test(tempJSONArray[i][tempJSONArray[i].length-1])?lastParse&&(j+=1):(printErr("Error: JSON text sequence ("+(i+1)+") lacking trailing whitespace: "+tempJSONArray[i]),JSONObjectArray[j]=void 0)}}else if(/^\s*\$/.test(fileText))try{JSONObjectArray[0]=ingestLiterals(fileText,option)}catch(b){printErr(b),quit()}else try{JSONObjectArray[0]=JSON.parse(fileText)}catch(b){var primaryParseErrorString=b;option.c&&printErr("Original error: "+b);tempJSONArray=rehabJSON(fileText);for(j=i=0;i<tempJSONArray.length;i++,j++)try{JSONObjectArray[j]=JSON.parse(tempJSONArray[i])}catch(k){printErr("Error in JSON Text ("+(i+1)+"): "+tempJSONArray[i].substring(0,24).replace(/[\n|\r]/g,"")+"\u2026"),printErr(k),--j}}if("a"==multiJSONArg){var JSONObjectArray_temp=[];for(i=0;i<=JSONObjectArray.length-1;i++)JSONObjectArray_temp[i]=JSONObjectArray[i];JSONObjectArray=[];JSONObjectArray[0]=JSONObjectArray_temp}var resultObjects=[];for(i=0;i<JSONObjectArray.length;i++){if(option.x||option.X||option.opArg.constructor===Object&&Object.keys(option.opArg).length)try{JSONObjectArray[i]=alterObject(JSONObjectArray[i],valueArg,fromArg,pathArg,option,i+1,JSONPatchArg)}catch(b){printErr(b);continue}if("$"!==query&&""!==query||option.j||option.r){try{var queryObject=objectifyExpressions([query],{disallowData:!0,allowExpressions:!0,c:option.c})[0].path}catch(b){printErr(b),quit()}try{resultObjects[i]=jsonPath(JSONObjectArray[i],queryObject,option.j||option.r?{resultType:option.d?"PATH_DOTTED":option.r?"PATH_JSONPOINTER":"PATH",singleQuoteKeys:option.q,"P.escapeUnicode":option.u?!0:!1}:null)}catch(b){printErr(b),quit()}}else resultObjects[i]=[JSONObjectArray[i]];void 0!==resultObjects&&resultObjects[i].length||(printErr("No nodes matching "+query+(1<JSONObjectArray.length?" in JSON text "+(i+1):"")),resultObjects[i]=void 0)}for(i=0;i<=resultObjects.length-1;i++)if(void 0!==resultObjects[i]){Array.isArray(resultObjects[i])&&1===resultObjects[i].length&&(resultObjects[i]=resultObjects[i][0]);if(option.N&&null!==resultObjects[i])for(;Array.isArray(resultObjects[i])&&1===resultObjects[i].length;)resultObjects[i].some(function(b){return null!=b&&"object"===typeof b}),resultObjects[i]=resultObjects[i][0];option.a&&!Array.isArray(resultObjects[i])&&(resultObjects[i]=[resultObjects[i]]);option.t&&(null===resultObjects[i]||!Array.isArray(resultObjects[i])&&resultObjects[i].constructor!==Object)&&(option.T=!0);option.l?null===resultObjects[i]?print("0"):resultObjects[i].constructor===Number?print("1"):resultObjects[i].constructor===Boolean?print("1"):resultObjects[i].constructor===String?print(resultObjects[i].length):Array.isArray(resultObjects[i])?print(resultObjects[i].length):resultObjects[i].constructor===Object&&print(Object.keys(resultObjects[i]).length):(option.O&&(resultObjects[i]=sortObject(resultObjects[i])),option.F&&Array.isArray(resultObjects[i])&&(resultObjects[i]=flatten(resultObjects[i])))}option.l&&quit();if("A"==multiJSONArg){var resultObjects_new=[[]];for(i=0;i<=resultObjects.length-1;i++)resultObjects_new[0][i]=resultObjects[i];resultObjects=resultObjects_new}for(i=0;i<=resultObjects.length-1;i++)if(void 0!==resultObjects[i]){if(option.T||option.L||option.J||option.R||option.j||option.r){option.j||option.r||(resultObjects[i]=renderObject(resultObjects[i],option.T?null:option.R?"":"$",option));var resultText=null===resultObjects[i]?option.n?"null":void 0:Array.isArray(resultObjects[i])?resultObjects[i].join("\n"):resultObjects[i].toString()}else{"N"==multiJSONArg&&(spaceArg=0);try{resultText=JSON.stringify(resultObjects[i],null,spaceArg).replace(option.u?/[\u007f-\uFFFF]/g:/[\u007f]/g,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}).replace(option["/"]?/[\/]/g:void 0,"\\/")}catch(b){printErr("JSON.stringify: "+b)}}(option.encoding.w||option.encoding.W)&&(option.r||option.R)&&(resultText=resultText.split("\n").map(function(b){return"#"+encodeURI(b)}).join("\n"));var possibleRS=!option.T&&("S"==multiJSONArg||1<resultObjects.length&&!multiJSONArg)?"\u001e":"";if(void 0!==resultText)if(resultText.length>maxSize.print)jscChunkPrint(possibleRS+resultText);else try{print(possibleRS+resultText)}catch(b){printErr("print "+b)}};
EOT

#shell script
locations=( "/System/Library/Frameworks/JavaScriptCore.framework/Versions/Current/Helpers/jsc" "/System/Library/Frameworks/JavaScriptCore.framework/Versions/Current/Resources/jsc" );for loc in ${locations[@]}; do [ -x "${loc}" ] && jsc="${loc}" && break; done;[ -z "${jsc}" ] && jsc=$(which jsc);if [ -z "${jsc}" ]; then locations=( "/System/Library/Frameworks/JavaScriptCore.framework/Versions/Current" "/usr/bin/jsc" "/usr/libexec/webkit2gtk*" );for loc in ${locations[@]}; do jsc=$(find -L "${loc}" -name 'jsc' -maxdepth 2 2>/dev/null);[ -n "${jsc}" ] && break;done;fi;[ -z "${jsc}" ] && echo "Unable to locate a jsc binary!" && exit 1;while getopts ":8cKkDSQPAE:Ff:lNLOuo:i:aCIeHhdnqgGJzjsRrTtUWwZ:v:V:x:X:p:M:%/" option; do case "${option}" in 'J'|'L'|'R'|'t'|'j'|'l'|'r'|'t') [ -z "${outputOpt}" ] && outputOpt="${option}" ;;'o')[ -z "${alterOp}" ] && { options+="${option}"; alterOp="${OPTARG}"; } ;;'p')[ -z "${pathArg}" ] && { options+="${option}"; pathArg="${OPTARG}"; } ;;'v'|'V')[ -z "${valueArg}" ] && { options+="${option}"; valueArg="${OPTARG}"; } ;;'f')[ -z "${fromArg}" ] && { options+="${option}"; fromArg="${OPTARG}"; } ;;'x'|'X')[ -z "${JSONPatchArg}" ] && { options+="${option}"; JSONPatchArg="${OPTARG}"; } ;;'i')options+="${option}"; spaceArg="${OPTARG}";;'M')options+="${option}"; multiOutArg="${OPTARG}";;'Z')depthArg="${OPTARG}";;'E')[ -z "${encodingArg}" ] && encodingArg+="${OPTARG/\%/W}";;'h')echo -e "${helpText}" | less; exit;;'?'):;;*)options+="${option}";;esac;done;options+="${outputOpt}";[ $OPTIND -ge 2 ] && shift $((OPTIND-1));queryArg="${1}";fileArg="${2}";[ -f "${queryArg}" ] && [ -z "${fileArg}" ] && { fileArg="${queryArg}"; unset queryArg; };readFileSupport="$(${jsc} -e 'print(typeof readFile === "function")')";if [ -n "${fileArg}" ]; then if [ "${fileArg}" != '/dev/stdin' ] && ! [ -f "${fileArg}" ]; then echo "--> File not found: ${fileArg}" >&2;return 1;elif ! [ -r "${fileArg}" ]; then echo "--> File not readable: ${fileArg}" >&2;return 1;fi;if [ "${readFileSupport}" = "true" ]; then if stat -f %z . &> /dev/null; then fileSize=$(stat -f %z "${fileArg}");elif stat -c %s . &> /dev/null; then fileSize=$(stat -c %s "${fileArg}");elif stat --format %s . &> /dev/null; then fileSize=$(stat --format %s "${fileArg}");fi;if [ "${fileSize}" -ge 2147483648 ]; then echo "--> File exceeds readFile() maximum size (2GiB)!" >&2;return 1;fi;fi;fi;if [ "${readFileSupport}" = "false" ]; then { errOut=$( { { "${jsc}" -e "${JSCode}" -- "${queryArg}" "" "${options}" "${spaceArg}" "${valueArg}" "${pathArg}" "${depthArg}" "${encodingArg}" "${alterOp}" "${fromArg}" "${JSONPatchArg}" "${multiOutArg}" <<< "$(sed '/^$/d' "${fileArg:-/dev/stdin}")" ; } 1>&3 ; } 2>&1); } 3>&1;elif [ -f "${fileArg:=/dev/stdin}" ]; then { errOut=$( { { "${jsc}" -e "${JSCode}" -- "${queryArg}" "${fileArg}" "${options}" "${spaceArg}" "${valueArg}" "${pathArg}" "${depthArg}" "${encodingArg}" "${alterOp}" "${fromArg}" "${JSONPatchArg}" "${multiOutArg}"; } 1>&3 ; } 2>&1); } 3>&1;else [ -t '0' ] && echo -e "$(echo -e "${helpText}" | head -n 1)\nUsage: jpt [options] [query] [filepath] (see jpt -h for more help...)" >/dev/stderr && exit 0; { errOut=$( { { "${jsc}" -e "${JSCode}" -- "${queryArg}" "/dev/stdin" "${options}" "${spaceArg}" "${valueArg}" "${pathArg}" "${depthArg}" "${encodingArg}" "${alterOp}" "${fromArg}" "${JSONPatchArg}" "${multiOutArg}" <<< "$(cat)"; } 1>&3 ; } 2>&1); } 3>&1;fi;if [ -n "$(sed -e '/^--> Debug:/d' <<< "${errOut}")" ]; then /bin/echo "$errOut" >&2; return 1; fi
)
#END FUNCTION

jpt "$@"
exit $?
